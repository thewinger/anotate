
<!DOCTYPE html>
<html>
	<head>
		<title>Anotate</title>
		<style type="text/css">
			body {
				background-color: #fafafa;
			}
			header {
				width: 50em;
				margin: 0 auto;
        overflow: hidden;
			}
      header h1 {
        float: left;
        margin: 0;
				font-family: 'Helvetica Neue', Arial, sans-serif;
        color: #fff;
      }
			header a {
				display: inline-block;
				cursor: pointer;
				padding: 18px;
				background: #00AE9D;
				font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
				font-size: 0.75em;;
				color: #fff;
        float:right;
			}
			#date {
				position: fixed;
				width: 720px;
				margin: 0 0 0 50%;
				top: 50px;
				bottom: 50px;
				left: -400px;
				padding: 20px 40px;
				background: #00AE9D;
				font-family: 'Helvetica Neue', Arial, sans-serif;
				font-size: 9pt;
				color: #222;
			}
			#editor {
				width: 50em;
				margin: 0 auto; 
				padding: 40px;
				outline: none;
				background: #FFF;
			}
			#editor, #editor * {
				font-family: monaco, monospace;
				font-size: 14pt;
				color: #222;
			}
		</style>
	</head>
	<body>
		<header>
      <h1 contenteditable="true">Title</h1>
			<a id="action-save">Download</a>
		</header>
		<div id="date"></div>
		<div id="editor" contenteditable="true"></div>

		<script type="text/javascript">
      /*var key = "draft",
      contentEl = document.getElementById("editor");

      contentEl.innerHTML = localStorage[key] || '';
      contentEl.onkeyup=function() {
        localStorage[key] = contentEl.innerHTML;
      };
      */
			var data = get();
			if(!data.edited && !data.data) data = {edited: (new Date()).getTime(), data: ''};

			function save() {
				data.edited = (new Date()).getTime();
				localStorage.setItem('data', JSON.stringify(data));

				render();
			}

			function get() {
				return JSON.parse(localStorage.getItem('data'));
			}

			function render() {
				var d = new Date(data.edited);

				document.getElementById("date").innerHTML = 'Last saved: <b>' 
						+ d.getFullYear() + '-' + d.getMonth() + '-' + d.getDate() + ' ' 
						+ d.getHours() + ':' 
						+ (d.getMinutes() < 10 ? '0' + d.getMinutes() : d.getMinutes()) 
						+ '</b>';
			}

			function saveToFile() {
				window.location = 'data:application/octet-stream,' + 
					escape(data.data
						.replace(/<div>/g, '\n')
						.replace(/<\/div>/g, '')
						.replace(/<br>/g, ''));
			}

			document.getElementById("editor").addEventListener('keyup', function(e) {
				data.data = document.getElementById("editor").innerHTML;
				save();
			});
			document.getElementById("editor").innerHTML = data.data;
			document.getElementById("editor").focus();

			document.getElementById("action-save").addEventListener('click', function(e) {
				saveToFile();
			});      
		</script>
	</body>
</html>
