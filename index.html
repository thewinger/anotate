
<!DOCTYPE html>
<html>
	<head>
		<title>Anotate</title>
		<style type="text/css">
      * {
        box-sizing: border-box;
      }
			body {
				background-color: #eee;
			}
      .wrapper {
        width: 50em;
          margin: 0 auto;
      }
			header {
        overflow: hidden;
        background-color: #00AE9D;
			}
      header h1 {
        float: left;
        margin: 0;
				font-family: 'Helvetica Neue', Arial, sans-serif;
        color: #fff;
        font-weight: 400;
        line-height: 4.375rem;
        padding-left: 1rem;
      }
      header h1:focus {
        outline: none;
      }
			header a {
				display: inline-block;
				cursor: pointer;
				background: #00AE9D;
				font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
				font-size: 0.75em;;
				color: #fff;
        float:right;
        line-height: 4.375rem;
        padding-left: 1rem;
			}
			#editor {
				padding: 40px;
				outline: none;
				background: #FFF;
			}
			#editor, #editor * {
				font-family: monaco, monospace;
				font-size: 14pt;
				color: #222;
			}
		</style>
	</head>
	<body>
    <div class="wrapper">
		<header>
      <h1 contenteditable="true"></h1>
			<!--<a id="action-save">Download</a>-->
		</header>
		<div id="editor" contenteditable="true"></div>
    </div>
		<script type="text/javascript">
      /*var key = "draft",
      contentEl = document.getElementById("editor");

      contentEl.innerHTML = localStorage[key] || '';
      contentEl.onkeyup=function() {
        localStorage[key] = contentEl.innerHTML;
      };
      */
  
			var data = get();
			//if(!data.edited && !data.data) data = {edited: (new Date()).getTime(), data: ''};

			function save() {
				data.edited = (new Date()).getTime();
				localStorage.setItem('data', JSON.stringify(data));

				render();
			}

			function get() {
				return JSON.parse(localStorage.getItem('data'));
			}

			function render() {
				var d = new Date(data.edited);

      function saveToFile() {
				window.location = 'data:application/octet-stream,' + 
					escape(data.data
						.replace(/<div>/g, '\n')
						.replace(/<\/div>/g, '')
						.replace(/<br>/g, ''));
			}

			document.getElementById("editor").addEventListener('keyup', function(e) {
				data.data = document.getElementById("editor").innerHTML;
				save();
			});
			document.getElementById("editor").innerHTML = data.data;
			document.getElementById("editor").focus();

			document.getElementById("action-save").addEventListener('click', function(e) {
				saveToFile();
			});      
		</script>
	</body>
</html>
